<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniBridge - Speech & Text</title>
    <!-- We need Tailwind and Lucide here too! -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide.js"></script>
    <style>
      body { font-family: 'Inter', sans-serif; }
      /* Make text areas look good in dark mode */
      textarea {
        background-color: #374151; /* gray-700 */
        color: #F3F4F6; /* gray-100 */
      }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen antialiased">

    <!-- Back Button -->
    <header class="p-6 max-w-7xl mx-auto w-full">
        <!-- This link takes the user back to the homepage -->
        <a href="/" class="flex items-center text-gray-400 hover:text-white group">
            <i data-lucide="arrow-left" class="w-5 h-5 mr-2 transition-transform group-hover:-translate-x-1"></i>
            Back to Home
        </a>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto p-6">
        <h1 class="text-4xl font-bold text-center mb-10">Speech & Text</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">

            <!-- MODULE 1: Text to Speech -->
            <div class="bg-gray-800 p-8 rounded-2xl">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <i data-lucide="file-text" class="w-7 h-7 mr-3 text-indigo-400"></i>
                    Text to Speech
                </h2>
                <p class="text-gray-300 mb-4">Type text below and click the button to hear it spoken.</p>
                
                <textarea id="textToSpeak" class="w-full h-48 p-4 rounded-lg border-2 border-gray-700 focus:border-indigo-500 focus:ring-0 outline-none" placeholder="Type anything here..."></textarea>
                
                <button id="speakButton" class="mt-4 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center transition-colors">
                    <i data-lucide="volume-2" class="w-5 h-5 mr-2"></i>
                    Speak
                </button>
            </div>

            <!-- MODULE 2: Speech to Text -->
            <div class="bg-gray-800 p-8 rounded-2xl">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <i data-lucide="mic" class="w-7 h-7 mr-3 text-indigo-400"></i>
                    Speech to Text
                </h2>
                <p class="text-gray-300 mb-4">Click the button and start speaking. Your words will appear below.</p>
                
                <textarea id="speechResult" class="w-full h-48 p-4 rounded-lg border-2 border-gray-700" placeholder="Your spoken text will appear here..."></textarea>
                
                <button id="listenButton" class="mt-4 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center transition-colors">
                    <i data-lucide="mic" class="w-5 h-5 mr-2"></i>
                    Start Listening
                </button>
                <p id="listenStatus" class="text-gray-400 text-sm text-center mt-3 h-4"></p>
            </div>

        </div>
    </main>

    <!-- This script loads the icons -->
    <script>
      lucide.createIcons();
    </script>

    <!-- 
      MENTOR NOTE:
      This is the JavaScript "Magic" for this page.
      It runs in the user's browser (client-side).
      It does NOT use our Python server at all.
    -->
    <script>
        // --- PART 1: TEXT-TO-SPEECH ---
        const speakButton = document.getElementById('speakButton');
        const textToSpeak = document.getElementById('textToSpeak');

        speakButton.addEventListener('click', () => {
            const text = textToSpeak.value;
            if (text.trim().length > 0) {
                // Use the browser's built-in Speech API
                const utterance = new SpeechSynthesisUtterance(text);
                window.speechSynthesis.speak(utterance);
            }
        });

        // --- PART 2: SPEECH-TO-TEXT ---
        // Check if the browser supports the SpeechRecognition API
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        
        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            const listenButton = document.getElementById('listenButton');
            const speechResult = document.getElementById('speechResult');
            const listenStatus = document.getElementById('listenStatus');

            listenButton.addEventListener('click', () => {
                listenStatus.textContent = 'Listening...';
                listenButton.disabled = true; // Disable button while listening
                // Update button text and icon
                listenButton.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 mr-2 animate-spin"></i> Listening...';
                lucide.createIcons(); // Redraw icon
                
                try {
                  recognition.start();
                } catch(e) {
                  listenStatus.textContent = 'Error: recognition already started.';
                  listenButton.disabled = false;
                }
            });

            // This event fires when speech is recognized
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                speechResult.value = transcript;
            };

            // This event fires when recognition ends
            recognition.onend = () => {
                listenStatus.textContent = '';
                listenButton.disabled = false;
                // Reset button text and icon
                listenButton.innerHTML = '<i data-lucide="mic" class="w-5 h-5 mr-2"></i> Start Listening';
                lucide.createIcons(); // Redraw icon
            };

            // This event fires on an error
            recognition.onerror = (event) => {
                listenStatus.textContent = 'Error: ' + event.error;
                listenButton.disabled = false;
                // Reset button text and icon
                listenButton.innerHTML = '<i data-lucide="mic" class="w-5 h-5 mr-2"></i> Start Listening';
                lucide.createIcons(); // Redraw icon
            };

        } else {
            // If browser doesn't support the API
            document.getElementById('listenButton').style.display = 'none';
            document.getElementById('listenStatus').textContent = 'Sorry, your browser does not support Speech to Text.';
        }
    </script>
</body>
</html>