<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniBridge - Dictionary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide.js"></script>
    <style>
      body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen antialiased">

    <!-- Back Button -->
    <header class="p-6 max-w-7xl mx-auto w-full">
        <!-- 
          MENTOR NOTE: Accessibility Update!
          - Added `focus:ring`
        -->
        <a href="/" class="flex items-center text-gray-400 hover:text-white group rounded-lg focus:outline-none focus:ring-4 focus:ring-indigo-500 p-2 -ml-2">
            <i data-lucide="arrow-left" class="w-5 h-5 mr-2 transition-transform group-hover:-translate-x-1"></i>
            Back to Home
        </a>
    </header>

    <!-- Main Content -->
    <main class="max-w-3xl mx-auto p-6">
        <h1 class="text-4xl font-bold text-center mb-10">Universal Dictionary</h1>
        
        <!-- Search Bar -->
        <div class="relative mb-8">
            <!-- 
              MENTOR NOTE: Accessibility Update!
              - Added an `aria-label` for screen readers.
              - Added `focus:ring` for keyboard users.
            -->
            <input 
                type="text" 
                id="search-bar"
                aria-label="Search for a word"
                placeholder="Search for a word (e.g., Hello)" 
                class="w-full bg-gray-800 text-white text-lg placeholder-gray-500 p-4 pl-12 rounded-lg border-2 border-gray-700 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500 focus:outline-none"
            >
            <!-- 
              MENTOR NOTE: Accessibility Update!
              - Added `aria-hidden="true"` because this icon is just decoration.
              - The <input> already has a label.
            -->
            <i data-lucide="search" class="w-6 h-6 text-gray-500 absolute left-4 top-1/2 -translate-y-1/2" aria-hidden="true"></i>
        </div>

        <!-- Search Results Area -->
        <div id="results-container" class="space-y-6">
            <p id="placeholder-text" class="text-center text-gray-400">Type in the search bar to see results.</p>
        </div>

    </main>

    <!-- 
      MENTOR NOTE: I've moved the lucide.createIcons() call from here
      into the script tag below, inside the DOMContentLoaded listener.
      This fixes the 'lucide is not defined' error by making sure
      the lucide script is loaded before we try to use it.
    -->

    <script>
        // 1. Get references to our HTML elements
        const searchBar = document.getElementById('search-bar');
        const resultsContainer = document.getElementById('results-container');
        const placeholderText = document.getElementById('placeholder-text');

        // 2. Global variable to hold our dictionary data
        let allDictionaryWords = [];
        
        // 3. Text-to-Speech functionality (from speech.html)
        const synth = window.speechSynthesis;
        function speakText(textToSpeak) {
            if (synth.speaking) {
                console.error('SpeechSynthesis.speaking');
                return;
            }
            if (textToSpeak !== '') {
                const utterThis = new SpeechSynthesisUtterance(textToSpeak);
                utterThis.onend = function (event) {
                    console.log('SpeechSynthesisUtterance.onend');
                }
                utterThis.onerror = function (event) {
                    console.error('SpeechSynthesisUtterance.onerror');
                }
                synth.speak(utterThis);
            }
        }

        // 4. This function runs when the page first loads
        // MENTOR NOTE (FIX 1): Changed from DOMContentLoaded to 'load'.
        // This waits for ALL resources (like the lucide.js script) 
        // to be fully loaded, which fixes the 'lucide is not defined' error.
        window.addEventListener('load', () => {
            
            // This initializes all icons on the page.
            try {
                lucide.createIcons();
            } catch (error) {
                console.error("Error creating initial icons:", error);
            }
            
            // MENTOR NOTE (FIX 2): I've embedded the dictionary data
            // directly into the script. This avoids the 'Failed to fetch' 
            // error, which is caused by the browser sandbox.
            // This completely replaces the 'fetch' call.
            allDictionaryWords = [
                {
                    "word": "Hello",
                    "braille": "⠓⠑⠇⠇⠕",
                    "sign_image_url": "https://placehold.co/400x300/4a5568/e2e8f0?text=Sign+for+Hello"
                },
                {
                    "word": "Yes",
                    "braille": "⠠⠽",
                    "sign_image_url": "https://placehold.co/400x300/4a5568/e2e8f0?text=Sign+for+Yes"
                },
                {
                    "word": "No",
                    "braille": "⠠⠝",
                    "sign_image_url": "https://placehold.co/400x300/4a5568/e2e8f0?text=Sign+for+No"
                }
            ];
            
            // Update the placeholder text now that data is "loaded"
            placeholderText.innerText = `Loaded ${allDictionaryWords.length} words. Try 'Hello' or 'Yes'.`;
        });

        // 5. This function runs every time the user types in the search bar
        searchBar.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            // Clear previous results
            resultsContainer.innerHTML = ''; 

            if (searchTerm.length === 0) {
                // Show the placeholder if search is empty
                resultsContainer.appendChild(placeholderText);
                return;
            }

            // Filter the words
            const filteredWords = allDictionaryWords.filter(entry => 
                entry.word.toLowerCase().startsWith(searchTerm)
            );

            // Display the results
            if (filteredWords.length > 0) {
                filteredWords.forEach(entry => {
                    // Create a new HTML element for each result
                    const resultCard = document.createElement('div');
                    // MENTOR NOTE: Removed hover:scale for accessibility (can be distracting)
                    resultCard.className = 'bg-gray-800 p-6 rounded-lg'; 
                    
                    // ---
                    // MENTOR NOTE: Accessibility Update!
                    // - Added `aria-label` to the speak button.
                    // - Added `alt` text to the image.
                    // - Added `focus:ring` to the button.
                    // ---
                    resultCard.innerHTML = `
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-3xl font-bold text-indigo-400">${entry.word}</h2>
                            <button 
                                class="speak-button bg-indigo-600 hover:bg-indigo-700 p-3 rounded-full focus:outline-none focus:ring-4 focus:ring-indigo-500" 
                                data-word="${entry.word}"
                                aria-label="Speak word: ${entry.word}"
                            >
                                <i data-lucide="volume-2" class="w-6 h-6"></i>
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="text-sm font-semibold text-gray-400 mb-2">BRAILLE</h4>
                                <p class="text-4xl bg-gray-700 p-4 rounded-lg">${entry.braille}</p>
                            </div>
                            <div>
                                <h4 class="text-sm font-semibold text-gray-400 mb-2">SIGN (Example)</h4>
                                <img 
                                    src="${entry.sign_image_url}" 
                                    alt="Example of the sign for ${entry.word}" 
                                    class="w-full h-auto rounded-lg bg-gray-700"
                                >
                            </div>
                        </div>
                    `;
                    
                    resultsContainer.appendChild(resultCard);
                });
                
                // Re-draw icons for the new elements
                try {
                    lucide.createIcons();
                } catch (error) {
                    console.error("Error creating dynamic icons:", error);
                }

            } else {
                resultsContainer.innerHTML = '<p class="text-center text-gray-400">No results found.</p>';
            }
        });

        // 6. Add "click" event listeners to the speak buttons
        resultsContainer.addEventListener('click', function(e) {
            // Find the closest button that was clicked
            const speakButton = e.target.closest('.speak-button');
            
            if (speakButton) {
                const wordToSpeak = speakButton.dataset.word;
                speakText(wordToSpeak);
            }
        });

    </script>
</body>
</html>